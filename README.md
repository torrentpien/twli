# twli

台灣里套件

版本：0.01

簡介：

台灣約有7700多個村里，由於人口流動、行政區重新區劃，村里時常進行整併，村里整併問題造成跨年度村里分析、研究時的極大難題。台灣里套件將研究分析年度的村里整併情況進行彙整，讓使用者能根據彙整結果將各年度的村里相關數據合併後能保持一致，以利合併為各年度村里相同的面板數據（panel data）。

使用說明：

1. 處理流程：

![](https://github.com/torrentpien/twli/blob/master/%E7%A4%BA%E6%84%8F%E5%9C%96.png?raw=true)

台灣里套件目前初步開發四個函數，分別為liRef、liSum、liEqu、liShp，四個函數的功能及與所需整併資料的關係如下：

台灣村里整併表：按照台灣里套件規格編制的台灣村里整併表，對台灣里套件使用者來說，台灣村里整併表為基礎資料表格，需不斷增補與更新，紀錄研究分析所需的村里合併或分割資料，透過其他台灣里函數，將村里整併表中的紀錄進行各種村里整併。台灣村里整併表編制規格請參考。

所需整併村里資料：研究者需要整併的資料。需包含村里代碼欄位，建議使用內政部村里代碼，如桃園市桃園區文化里的村里代碼為：6800100-001。

liRef函數：按照研究的年度範圍及所需整併的檔案年度，將台灣村里整併表整理後產生村里整併參照檔。

村里整併參照檔：liRef函數產生的數據框（dataframe），內容為所需整併村里的分組列表，以利liSum、liEqu、liShp等函數進行運算。

liSum函數：需整併村里資料的相加。

liEqu函數：許多需整併村里資料不是簡單的相加，需要各欄位運算後產生新數字，台灣里套件提供使用者自訂公式，計算村里整併後的新數據。

liShp函數：將村里shapefile圖資按照村里整併參照檔進行整併。

2. 安裝：

3. 台灣村里整併表編制規格
  
  -必要欄位：村里代碼、年度、該年度整併模式
  
  如果研究分析所記錄的村里整併資料年度為2014、2018年，必要欄位如下：

| li_id | 2014 | mode_2014 | 2018 | mode_2018 |
|    :---:    |    :---:    |    :---:    |    :---:    |    :---:    | 
| 村里代碼 | 2014整併後最終村里代碼 | 2014年整併模式 | 2018整併後最終村里代碼 | 2018年整併模式 |

必要欄位說明：

li_id（村里代碼）：列出所有的村里代碼，包括因為合併後被消滅的村里。建議使用內政部村里代碼。

2014、2018（各年度整併後最終村里代碼）：將合併或分割的最終村里代碼，如果不只一個村里，以"|"分隔。

mode_2014、mode_2018（各年度整併模式）：

包括下列四種模式，請以英文小寫編碼：

m: merge，指村里合併，也就是說，li_id欄位的村里被消滅，於該年度合併進「最終村里代碼」的村里。

s: separate，指村里分割，「最終村里代碼」的村里分割為li_id欄位的村里及「最終村里代碼」的村里。

c: complex，指複雜型村里整併，複雜的定義為牽涉兩個以上的li_id欄位村里之合併及分割。

vbox: vote box，指兩個村里被編為一個選舉投開票所，如果處理選舉資料，必須將其他沒有進行村裡整併的村里人口、教育等資料進行整併。

非必要欄位：  
  
   可在各年度整併後最終村里代碼前放進其他欄位，台灣村里整併表範例（li_table.xlsx）即按照下列欄位編制：
  
| city_code | city_name | district_code | district_name | li_id | li_name | li_id_dgb | 2014 | mode_2014 | 2018 | mode_2018 |
|    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |
| 縣市代碼 | 縣市名稱 | 區代碼 | 區名稱 | 村里代碼 | 村里名稱 | 主計處村里代碼 | 2014 | mode_2014 | 2018 | mode_2018 |
|    |    |    |    | ● |    |    | ● | ● | ● | ● |

●：必要欄位

注意：各年度整併後最終村里代碼、各年度整併模式(即2014、mode_2014、2018、mode_2018)必須置於台灣村里整併表最後欄位。

整併模式輸入案例：

m（合併）: 2014年7月，高雄市鳳山區海風里（6401200-023）因為人口過少，僅剩46戶，高雄市政府宣布將海風里合併進鳳山區海光里（6401200-022）。
  
| city_code | city_name | district_code | district_name | li_id | li_name | li_id_dgb | 2014 | mode_2014 | 2018 | mode_2018 |
|    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |
|  64  |  高雄市  |  6401200  |  鳳山區  |  6401200-023  |  海風里  |  64000121023  |   6401200-022  |  m  |  |  |

s（分割）：

2018年3月，桃園市桃園區忠義里（6800100-005）因人口增加，忠義里拆為忠義里及新增的福元里（6800100-079）。

| city_code | city_name | district_code | district_name | li_id | li_name | li_id_dgb | 2014 | mode_2014 | 2018 | mode_2018 |
|    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |
|  68  |  桃園市  |  6800100  |  桃園區  |  6800100-079  |  福元里  |  68000010079  |   |  |  6800100-005  |  s  |

c（複雜）：2014年1月，桃園市蘆竹區因人口增加，進行村里整併，其中中福里（6800500-002）、大竹里（6800500-004）、新興里（6800500-001）各取部分居民組為上興里（6800500-037），但同時，中福里（6800500-002）又將部分居民分割為中興里（6800500-036），又同時，富竹里（6800500-021）及上竹里（6800500-022）將部分居民劃歸為大竹里（6800500-004）。

| city_code | city_name | district_code | district_name | li_id | li_name | li_id_dgb | 2014 | mode_2014 | 2018 | mode_2018 |
|    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |
|  68  |  桃園市  |  6800500  |  蘆竹區  |  6800500-021  |  富竹里  |  68000050021  |   6800500-004  |  c  |  |  |
|  68  |  桃園市  |  6800500  |  蘆竹區  |  6800500-021  |  上竹里  |  68000050022  |   6800500-004  |  c  |  |  |
|  68  |  桃園市  |  6800500  |  蘆竹區  |  6800500-036  |  中興里  |  68000050036  |   6800500-002  |  c  |  |  |
|  68  |  桃園市  |  6800500  |  蘆竹區  |  6800500-037  |  上興里  |  68000050037  |   6800500-001\|6800500-002\|6800500-004  |  c  |  |  |

vbox（一投開票所多村里）：2014年縣市長選舉，台中市西屯區協和里（6600600-020）、福恩里（6600600-035）部分居民合併至獨立投開票所（6600600-9999）投票。

| city_code | city_name | district_code | district_name | li_id | li_name | li_id_dgb | 2014 | mode_2014 | 2018 | mode_2018 |
|    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |    :---:    |
|  66  |  台中市  |  6600600  |  西屯區  |  6600600-035  |  福恩里  |  66000060035  |   6600600-020\|6600600-9999  |  vbox  |  |  |

4. 函數說明：

liRef(year_range, file_year, li_table, vbox, done)

liSum(data, col_range, merge_gp)

liEqu(data, result, equ, merge_gp)

liShp(data, merge_gp)



